# Copyright 2018-2026 Chris Croome
#
# This file is part of the Webarchitects Node.js Ansible role.
#
# The Webarchitects Node.js Ansible role is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
#
# The Webarchitects Node.js Ansible role is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with the Webarchitects Node.js Ansible role. If not, see <https://www.gnu.org/licenses/>.
---
- name: Install Node.js using distro apt package
  block:

    - name: Nodesource apt files and binary node and associated symlinks absent
      ansible.builtin.file:
        path: "{{ nodejs_path }}"
        state: absent
      loop:
        - /etc/apt/preferences.d/node.pref
        - /etc/apt/sources.list.d/node.sources
        - /usr/local/bin/corepack
        - /usr/local/bin/node
        - /usr/local/bin/nodejs
        - /usr/local/bin/npm
        - /usr/local/bin/npx
        - /usr/share/keyrings/nodesource.gpg
      loop_control:
        loop_var: nodejs_path
        label: "{{ nodejs_path | ansible.builtin.basename }}"

    - name: Distro nodejs packages present
      ansible.builtin.apt:
        pkg:
          - nodejs
          - npm
        update_cache: true
        state: present

  tags:
    - nodejs
...
