---
- name: apt-transport-https and lsb-release packages present
  apt:
    pkg:
      - apt-transport-https
      - lsb-release
    state: present
    update_cache: false
  tags:
    - nodejs

- name: Check the distro version using lsb_release
  shell: "lsb_release -c | awk '{ print $2 }'"
  register: nodejs_distro_check
  changed_when: false
  check_mode: false
  tags:
    - nodejs

- name: Set nodejs_distro variable
  set_fact:
    nodejs_distro: "{{ nodejs_distro_check.stdout }}"
  tags:
    - apt

- name: Nodesource GPG key present
  apt_key:
    id: 9FD3B784BC1C6FC31A8A0A1C1655A0AB68576280
    url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
    state: present
  tags:
    - nodejs

- name: Nodesource APT repo available
  template:
    src: templates/nodejs.conf.j2
    dest: /etc/apt/sources.list.d/nodejs.list
  tags:
    - nodejs

- name: Nodejs package present
  apt:
    pkg:
      - nodejs
    state: present
    update_cache: true
  tags:
    - nodejs
...
